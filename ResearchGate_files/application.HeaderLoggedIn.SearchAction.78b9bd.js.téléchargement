(window.wjp=window.wjp||[]).push([[33],{5937:function(e,t,i){"use strict";i.r(t);var n=i(2),s=i(864),a=i(258),r=i.n(a),c=i(121),l=i.n(c),h=i(4),d=i(8),o=i.n(d),u=i(1),j=i(36),b=i(21),g=(i(6158),i(0));const m=new o.a("header-search-action"),p={query:"",hasUserTyped:!1,items:[],highlightedIndex:null,searchTypes:[{index:0,name:"publication",label:"research"},{index:2,name:"researcher",label:"people"},{index:1,name:"journal",label:"journals"}],wasPropsQuerySavedOnState:!1,isLoading:!1};class x extends h.Component{constructor(...e){super(...e),this.state=p,this.inputValueChange=e=>{const{url:t,viewId:i,onValueChange:n}=this.props;n&&n(e);const s={query:e,viewId:i};this.state.isLoading&&this.fetchRequest.cancel(),this.fetchRequest=Object(j.e)(Object(b.default)(t,{query:s})),this.setState({query:e,isLoading:!0}),this.fetchRequest.promise.then(e=>{this.setState({isLoading:!1}),e.success&&this.setState({items:e.result})}).catch(({isCanceled:e})=>{e||this.setState({items:[],isLoading:!1,highlightedIndex:null})})},this.handleInputValueChange=l()(this.inputValueChange,200)}static getDerivedStateFromProps(e,t){var i;return null!==(i=e.initialQueryRef)&&void 0!==i&&i.current&&!t.wasPropsQuerySavedOnState?Object(n.a)(Object(n.a)({},t),{},{query:e.initialQueryRef.current,wasPropsQuerySavedOnState:!0}):t}getCurrentlySelectedOnEnter(){const{items:e,highlightedIndex:t,query:i,searchTypes:n}=this.state,{formUrl:s,viewId:a,enableSearchIntentInHeaderSearch:r}=this.props;if(null!==t&&e.length>t)return e[t];const c=n.find(e=>e.index===t),l=r?"default":"publication";return{url:`${s}?origin=ac&headerSearchViewId=${a}&query=${i}&type=${c?c.name:l}`}}handleInputKeyDown(e){if("Enter"===e.key&&e.target.value){e.persist(),e.stopPropagation(),e.preventDefault();const t=this.getCurrentlySelectedOnEnter();t&&t.url?window.location.href=t.url:Promise.resolve().then(()=>{e.target.form.submit()})}}showResults(e,t){return!(!e||!t||0===t.length)}componentDidMount(){const{query:e}=this.state;e!==p.query&&this.inputValueChange(e)}componentDidUpdate(e,t){if(this.state.items.length!==t.items.length){const e=0===this.state.items.length?0:this.state.items.length,t=[{index:e,name:"publication",label:"research"},{index:e+2,name:"researcher",label:"people"}];t.push({index:e+1,name:"journal",label:"journals"}),this.setState(e=>Object(n.a)(Object(n.a)({},e),{},{searchTypes:t}))}}render(){const{query:e,searchTypes:t,items:i}=this.state,{input:a,formUrl:c,viewId:l}=this.props;return Object(g.jsx)(s.default,{itemToString:t=>t?t.name:e,initialInputValue:e,initialIsOpen:!1,onInputValueChange:this.handleInputValueChange,onStateChange:({highlightedIndex:t,inputValue:i})=>{this.state.hasUserTyped?this.setState({highlightedIndex:t,query:i||e}):this.setState({highlightedIndex:t,query:i||e,hasUserTyped:!0})},children:({getInputProps:s,getItemProps:d,highlightedIndex:o,inputValue:j,isOpen:b})=>{const p=s({id:"header-search-action"}),x=p.onKeyDown;return p.onKeyDown=e=>{x(e),this.handleInputKeyDown(e)},Object(g.jsxs)("div",Object(n.a)(Object(n.a)({},m()),{},{children:[Object(h.cloneElement)(a,p),this.showResults(b,j)&&Object(g.jsx)("div",Object(n.a)(Object(n.a)({},m("results")),{},{children:Object(g.jsxs)("div",Object(n.a)(Object(n.a)({},m("list")),{},{children:[Object(g.jsx)(u.Stack,{showDivider:!0,spacing:"xs",children:Object(g.jsx)(u.Stack.Item,{children:Object(g.jsx)(u.Text,Object(n.a)(Object(n.a)({},m("head")),{},{children:"Search for"}),"heading")})}),Object(g.jsx)("span",Object(n.a)({},m("divider")),"divider"),Object(g.jsxs)(u.Stack,{showDivider:!0,spacing:"xs",gutterOutside:!0,children:[i.map((e,t)=>Object(g.jsx)(u.Stack.Item,{children:Object(g.jsx)("div",{onClick:()=>window.location.assign(e.url),children:Object(g.jsx)("a",Object(n.a)(Object(n.a)(Object(n.a)({},d({item:e})),m({element:"list-item",extra:t===o?"is-highlighted":""})),{},{children:Object(g.jsxs)(u.PersonListItem,{size:"s",children:[e.image?Object(g.jsx)(u.PersonListItem.Image,{alt:e.name,imageUrl:e.image}):null,Object(g.jsx)(u.PersonListItem.Fullname,{children:e.name}),e.institution?Object(g.jsx)(u.PersonListItem.MetaItems,{children:Object(g.jsx)(u.PersonListItem.MetaItem,{children:e.institution})}):null]})}))})},e.id)),t.sort((e,t)=>e.index-t.index).map(({index:t,name:i,label:s})=>Object(g.jsx)(u.Stack.Item,{onClick:()=>{const t=`${c}?origin=ac&headerSearchViewId=${l}&query=${e}&type=${i}`;return window.location.assign(t)},children:Object(g.jsx)("a",Object(n.a)(Object(n.a)(Object(n.a)({},d({item:i})),m({element:"list-item",extra:t===o?"is-highlighted":""})),{},{children:Object(g.jsxs)(u.Flex,{gutter:"xxs",alignItems:"flex-start",children:[Object(g.jsx)(u.Flex.Item,{children:Object(g.jsx)(u.Icon,{identifier:"magnifier"})}),Object(g.jsx)(u.Flex.Item,{children:Object(g.jsx)(u.Text,{children:Object(g.jsx)("strong",{children:j})})}),Object(g.jsx)(u.Flex.Item,{children:Object(g.jsx)(u.Text,{children:" in "})}),Object(g.jsx)(u.Flex.Item,{children:Object(g.jsx)(u.Text,{color:"grey-600",children:r()(s)})})]})}))},t))]})]}))}))]}))}})}}x.displayName="SearchAction",t.default=x},6158:function(e,t,i){}}]);